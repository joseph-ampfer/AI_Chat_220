<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Chat 220</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link href="CSS/custom.css" rel="stylesheet">
</head>

<body>
  <!-- NavBar to access user chats and serve as intro to our website -->
  <nav class="navbar navbar-expand-lg">
    <div class="container-fluid">
      <a class="navbar-brand d-flex align-items-center" href="#">
        <img src="images/project_logo.png" alt="Logo" width="80" height="74" class="me-2">
        <span>Chat 220</span>
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="#">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="chats.html">Chat with AI</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <!-- Search Bar section that will hover above a gif of the AI model in action -->
  <div class="container-fluid mb-5" id="searcharea">
    <form class="d-flex" role="search" id="searchbar" onsubmit="return false;">
      <input class="form-control me-2" type="search" placeholder="Search our Chats" aria-label="Search" id="userSearch"
        onkeyup="searchBar()">
    </form>
  </div>
  <!-- This <div> will host the posts that are made and also serve as the search results area -->
  <div class="container text-center mb-5">
    <h1 style="margin-bottom: 45px" id="sectionHeader">Recent AI Posts from our Users</h1>
    <div class="row g-3" id="web-content">
    </div>
  </div>
  <!-- Footer for spacing and "copyright" stuff -->
  <footer class="container-fluid">
    <div class="container text-center pt-5">
      <p style="color: white"> &copy; ASE_AI_220</p>
    </div>
  </footer>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>
  <script>
    const JSON_BLOB_URL = "https://jsonblob.com/api/jsonBlob/1346491622271148032";
    const divRow = document.getElementById("web-content");


    let posts = [];

    async function fetchJSON(url) {
      const response = await fetch(url);
      if (!response.ok) throw new Error(`Fetch failed: ${response.statusText}`);
      return response.json();
    }

    async function loadPosts() {
      posts = await fetchJSON(JSON_BLOB_URL);

      for (let i = 0; i < posts.length; i++) {
        let postCol = document.createElement("div");
        postCol.classList.add("col", "col-12", "col-md-6", "col-lg-4");

        let postCard = document.createElement("div");
        postCard.classList.add("card");
        postCard.style.width = "20rem";
        postCard.style.margin = "auto";

        let cardData = document.createElement("div");
        cardData.classList.add("card-body");

        let cardTitle = document.createElement("h5");
        cardTitle.classList.add("card-title");
        cardTitle.innerText = posts[i].chat_summary["title"];
        cardData.appendChild(cardTitle);

        let cardAuthor = document.createElement("h6");
        cardAuthor.innerText = `Chat by: ${posts[i].username}`;
        cardData.appendChild(cardAuthor);

        let cardText = document.createElement("p");
        cardText.innerText = posts[i].chat_summary["summary"];
        cardData.appendChild(cardText);

        let cardLink = document.createElement("a");
        cardLink.setAttribute('href', 'chats.html'); // make this link to the JSONBlob that is uploaded once Joey fixes the post feature.
        cardLink.classList.add("card-link");
        cardLink.innerText = 'Check out this Conversation';
        cardData.appendChild(cardLink);

        postCard.appendChild(cardData);
        postCol.appendChild(postCard);
        divRow.appendChild(postCol);

      }

    }

    loadPosts();

    // This is close to working, have to make it so the items can move to the front of the list. Need to add animation for searchbar to scoll to search results.
    function searchBar() {
      let input, filter, col, card, cardData, cardTitle, i; // Variables to get the search input, filter the input, select the cards that are being searched by title, and an iteration variable.
      input = document.getElementById("userSearch");
      filter = input.value.toLowerCase();
      col = document.getElementsByClassName("col");
      card = document.getElementsByClassName("card");
      let searchBar = document.getElementById("searchbar");
      let resultsContainer = document.getElementById("web-content");
      let sectionHeader = document.getElementById("sectionHeader");
      let resultsFound = false;

      for (i = 0; i < card.length; i++) {
        cardData = card[i].getElementsByClassName("card-body")[0];
        cardTitle = cardData.getElementsByClassName("card-title")[0];
        let title = cardTitle.textContent || cardTitle.innerText;
        if (title.toLowerCase().indexOf(filter) > -1) {
          card[i].style.display = "";
          resultsFound = true;
        } else {
          card[i].style.display = "none";

        }
      }

      if (filter === "") {
        searchBar.style.marginTop = "0px"; 
        window.scrollTo({ top: 0, behavior: "smooth" });
        sectionHeader.innerText = "Recent AI Posts from our Users";
        return;
      }

      if (resultsFound) {
        searchBar.style.transition = "all 0.5s ease-in-out";
        searchBar.style.marginTop = "1000px";
        resultsContainer.scrollIntoView({ behavior: "smooth", block: "start" });
        sectionHeader.innerText = "Search Results";
      } else {
        searchBar.style.marginTop = "0px";
        sectionHeader.innerText = "Results not found :(";

      }
    }

  </script>
</body>

</html>